<html>

<head>

<title>Adam Mark - Improving map performance with Canvas</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
<meta name="title" content="Adam Mark - Improving map performance with Canvas"/>

<link href="../main.css?1692300141312" rel="stylesheet">

</head>

<body>

<main>

<a href="../">Adam Mark</a>

<h1>Improving map performance with Canvas</h1>

<section>
<h3>Background</h3>

<p>From 2020 to 2023, I developed dashboards and mapping tools for a warehouse automation system using TypeScript, React and SVG.</p>
</section>

<section>
<h3>Problem</h3>

<p>Our custom mapping system was built with SVG. While SVG was versatile and worked nicely with React, it showed strain when we tried to render more than a few hundred elements at once. <i>We needed a performant way to create complex data visualizations like heat maps.</i></p>

</section>

<section>
<h3>Solution</h3>

<p>I added a drawing surface to the map using the <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API">Canvas API</a>, along with utility methods for working with the map's coordinate system. This allowed us to draw thousands of individual elements on the screen without sacrificing performance, as shown in the following examples:</p>

<p><img src="https://user-images.githubusercontent.com/28193/216771249-da851b28-9591-4327-a696-891a3a9414cc.png" width="100%"/></p>

<p><img src="https://user-images.githubusercontent.com/28193/216777398-ec513b0e-efa9-4540-9bc2-b93bf8f55a02.png" width="100%"/></p>

<p>The following demo illustrates the performance power of Canvas, using <a href="https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame" target="_blank">requestAnimationFrame</a> to schedule animations. As the user zooms in and out, the canvas redraws 1,000 circles at up to <i>60 frames per second</i>:</p>

<p>
  <video width="100%" controls>
    <source src="https://github.com/adammark/adammark.github.com/assets/28193/8d422b66-4363-487e-9892-4a043366270a" type="video/mp4"/>
  </video>
</p>

</section>

<section>
<h3>The code</h3>

<p>First, I exposed a hook, <code>useMapCanvas</code>, that allows client applications to access the drawing context:</p>

<script src="https://gist.github.com/adammark/721ab9476b40a61af768341d7587bf73.js"></script>

<p>Then I added a callback function, <code>onZoom</code>, to the Map component that allows clients to respond to zoom and pan events:</p>

<script src="https://gist.github.com/adammark/a6a4d45d268ec04aa3020f4f4e29bd02.js"></script>

<p>Finally, I could respond to this callback function with an arbitrary drawing routine:</p>

<script src="https://gist.github.com/adammark/95f5cebd5503ca5fe42d10292f90052a.js"></script>
</section>

<section>
<h3>Conclusion</h3>

<p>Adding a canvas layer to the map opened the door to all kinds of interesting data visualizations. While SVG excelled at rendering basic map features, Canvas allowed us to render almost anything, and fast!</p>
</section>

</main>

</body>

</html>
